<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Groupes</title>
<style>
  body { font-family: Arial; padding:10px; background:#f0f0f0; }
  .group { border:1px solid #ccc; margin:5px; padding:10px; border-radius:5px; }
  button { margin-left:10px; padding:5px; border-radius:5px; cursor:pointer; }
  input { padding:5px; width:70%; }
</style>
</head>
<body>
<h2>Groupes</h2>
<div id="groupsContainer"></div>
<input type="text" id="newGroupName" placeholder="Nom du groupe">
<button id="createGroupBtn">Créer un groupe</button>

<script type="module">
import { auth, db, createGroup } from "./firebase.js";
import { ref, get } from "firebase/database";

const groupsContainer = document.getElementById("groupsContainer");
const newGroupName = document.getElementById("newGroupName");
const createGroupBtn = document.getElementById("createGroupBtn");
const currentUser = auth.currentUser.uid;

// Afficher les groupes existants
get(ref(db, 'groups')).then(snapshot => {
  const groups = snapshot.val() || {};
  groupsContainer.innerHTML = '';
  for(let gid in groups){
    if(groups[gid].members && groups[gid].members[currentUser]){
      const div = document.createElement('div');
      div.className = "group";
      div.innerHTML = `<strong>${groups[gid].name}</strong>
                       <button onclick="openGroupChat('${gid}')">Ouvrir chat</button>`;
      groupsContainer.appendChild(div);
    }
  }
});

// Créer un groupe
createGroupBtn.addEventListener("click", () => {
  const name = newGroupName.value.trim();
  if(name === "") return alert("Entrez un nom !");
  createGroup(name).then(() => window.location.reload());
});

window.openGroupChat = function(groupId){
  window.location.href = `chat.html?id=${groupId}&type=group`;
};
</script>
</body>
</html>
