<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat</title>
<style>
  body { font-family: Arial; padding:10px; background:#f0f0f0; }
  #messagesContainer { height:60vh; overflow-y:auto; border:1px solid #ccc; padding:10px; margin-bottom:10px; border-radius:5px; background:white; }
  #messageInput { width:75%; padding:10px; }
  #sendBtn { padding:10px; }
  .message { margin-bottom:5px; padding:5px; border-radius:5px; }
</style>
</head>
<body>
<h2 id="chatTitle">Chat</h2>
<div id="messagesContainer"></div>
<input type="text" id="messageInput" placeholder="Ã‰crire un message...">
<button id="sendBtn">Envoyer</button>

<script type="module">
import { auth, sendMessage, listenMessages } from "./firebase.js";

const urlParams = new URLSearchParams(window.location.search);
const chatId = urlParams.get("id");
const chatType = urlParams.get("type");
const currentUser = auth.currentUser.uid;

const messagesContainer = document.getElementById("messagesContainer");
const messageInput = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");

listenMessages(chatId, chatType, messages => {
  messagesContainer.innerHTML = '';
  for(let mid in messages){
    const msg = messages[mid];
    const div = document.createElement('div');
    div.className = "message";
    div.style.background = msg.sender === currentUser ? "#4a90e2" : "#ccc";
    div.style.color = msg.sender === currentUser ? "white" : "black";
    div.innerText = `${msg.senderName}: ${msg.text}`;
    messagesContainer.appendChild(div);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  }
});

sendBtn.addEventListener("click", () => {
  const text = messageInput.value.trim();
  if(text === "") return;
  sendMessage(chatId, chatType, text).then(() => messageInput.value = "");
});
</script>
</body>
</html>
