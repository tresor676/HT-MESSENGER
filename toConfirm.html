<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>To Confirm</title>
<style>
  body { font-family: Arial; padding:10px; background:#f0f0f0; }
  .request { border:1px solid #ccc; margin:5px; padding:10px; border-radius:5px; }
  button { margin-left:10px; padding:5px; border-radius:5px; cursor:pointer; }
</style>
</head>
<body>
<h2>Demandes Ã  confirmer</h2>
<div id="toConfirmList"></div>

<script type="module">
import { auth, db, acceptFriendRequest, rejectFriendRequest } from "./firebase.js";
import { ref, get } from "firebase/database";

const toConfirmList = document.getElementById("toConfirmList");
const currentUser = auth.currentUser.uid;

get(ref(db, 'users')).then(snapshot => {
  const users = snapshot.val() || {};
  toConfirmList.innerHTML = '';
  for(let uid in users){
    if(users[uid].pendingRequests && users[uid].pendingRequests[currentUser]){
      const div = document.createElement('div');
      div.className = "request";
      div.innerHTML = `<strong>${users[uid].username}</strong>
                       <button id="accept-${uid}">Accepter</button>
                       <button id="reject-${uid}">Refuser</button>`;
      toConfirmList.appendChild(div);
      document.getElementById(`accept-${uid}`).addEventListener("click", () => {
        acceptFriendRequest(uid).then(() => window.location.reload());
      });
      document.getElementById(`reject-${uid}`).addEventListener("click", () => {
        rejectFriendRequest(uid).then(() => window.location.reload());
      });
    }
  }
});
</script>
</body>
</html>
